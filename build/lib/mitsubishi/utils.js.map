{
  "version": 3,
  "sources": ["../../../src/lib/mitsubishi/utils.ts"],
  "sourcesContent": ["import { KEY_SIZE } from \"./types\";\r\n\r\nexport function padIso7816(input: Buffer, blockSize = KEY_SIZE): Buffer {\r\n\t// Python's Crypto.Util.Padding.pad(..., \"iso7816\")\r\n\tconst padLen = blockSize - (input.length % blockSize);\r\n\tconst out = Buffer.alloc(input.length + padLen);\r\n\tinput.copy(out, 0);\r\n\tout[input.length] = 0x80;\r\n\t// the rest are 0x00 already\r\n\treturn out;\r\n}\r\n\r\nexport function unpadIso7816(padded: Buffer, blockSize = KEY_SIZE): Buffer {\r\n\t// Remove ISO 7816-4 padding: find last 0x80 and cut there, else throw\r\n\tlet i = padded.length - 1;\r\n\t// strip trailing 0x00\r\n\twhile (i >= 0 && padded[i] === 0x00) i--;\r\n\tif (i < 0 || padded[i] !== 0x80) {\r\n\t\tthrow new Error(\"Invalid ISO7816 padding\");\r\n\t}\r\n\treturn padded.subarray(0, i);\r\n}\r\n\r\n/** calc FCC as in Python: 0x100 - (sum(payload[0:20]) % 0x100)  then mod 0x100 */\r\nexport function calcFcc(payload: Buffer): number {\r\n\tconst slice = payload.subarray(0, 20);\r\n\tconst sum = slice.reduce((s, b) => s + b, 0);\r\n\treturn (0x100 - (sum % 0x100)) % 0x100;\r\n}\r\n\r\nexport function getMacFromStateId(id: string): string | null {\r\n\tconst parts = id.split(\".\");\r\n\tconst idx = parts.indexOf(\"devices\");\r\n\r\n\tif (idx >= 0 && parts.length > idx + 1) {\r\n\t\treturn parts[idx + 1]; // das ist die MAC\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAyB;AAElB,SAAS,WAAW,OAAe,YAAY,uBAAkB;AAEvE,QAAM,SAAS,YAAa,MAAM,SAAS;AAC3C,QAAM,MAAM,OAAO,MAAM,MAAM,SAAS,MAAM;AAC9C,QAAM,KAAK,KAAK,CAAC;AACjB,MAAI,MAAM,MAAM,IAAI;AAEpB,SAAO;AACR;AAEO,SAAS,aAAa,QAAgB,YAAY,uBAAkB;AAE1E,MAAI,IAAI,OAAO,SAAS;AAExB,SAAO,KAAK,KAAK,OAAO,CAAC,MAAM,EAAM;AACrC,MAAI,IAAI,KAAK,OAAO,CAAC,MAAM,KAAM;AAChC,UAAM,IAAI,MAAM,yBAAyB;AAAA,EAC1C;AACA,SAAO,OAAO,SAAS,GAAG,CAAC;AAC5B;AAGO,SAAS,QAAQ,SAAyB;AAChD,QAAM,QAAQ,QAAQ,SAAS,GAAG,EAAE;AACpC,QAAM,MAAM,MAAM,OAAO,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC;AAC3C,UAAQ,MAAS,MAAM,OAAU;AAClC;AAEO,SAAS,kBAAkB,IAA2B;AAC5D,QAAM,QAAQ,GAAG,MAAM,GAAG;AAC1B,QAAM,MAAM,MAAM,QAAQ,SAAS;AAEnC,MAAI,OAAO,KAAK,MAAM,SAAS,MAAM,GAAG;AACvC,WAAO,MAAM,MAAM,CAAC;AAAA,EACrB;AAEA,SAAO;AACR;",
  "names": []
}
