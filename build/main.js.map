{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["// The adapter-core module gives you access to the core ioBroker functions\n// you need to create an adapter\nimport * as utils from \"@iobroker/adapter-core\";\n\nimport { enumToStates, getMacFromStateId, isEnumValue, isValidIPv4 } from \"./lib/mitsubishi/utils\";\n\nimport { MitsubishiController } from \"./lib/mitsubishi/mitsubishiController\";\nimport type { ParsedDeviceState } from \"./lib/mitsubishi/types\";\nimport {\n\tAutoMode,\n\tFanSpeed,\n\tOperationMode,\n\tRemoteLock,\n\tVaneHorizontalDirection,\n\tVaneVerticalDirection,\n} from \"./lib/mitsubishi/types\";\n\ninterface Device {\n\tname: string;\n\tip: string;\n\tmac: string | undefined;\n\tcontroller: MitsubishiController;\n\tpollingJob?: NodeJS.Timeout;\n}\n\nclass MitsubishiLocalControl extends utils.Adapter {\n\tprivate devices: Device[] = [];\n\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\tname: \"mitsubishi-local-control\",\n\t\t});\n\t\tthis.on(\"ready\", this.onReady.bind(this));\n\t\tthis.on(\"stateChange\", this.onStateChange.bind(this));\n\t\tthis.on(\"unload\", this.onUnload.bind(this));\n\t}\n\n\t/**\n\t * Is called when databases are connected and adapter received configuration.\n\t */\n\tprivate async onReady(): Promise<void> {\n\t\tawait this.setAdapterConnectionState(false);\n\n\t\tif (!this.validateConfig()) {\n\t\t\tthis.log.error(\"Invalid configuration detected. Stopping adapter.\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log.info(`Configuring ${this.config.devices.length} device(s)...`);\n\n\t\tthis.devices = (this.config.devices ?? []).map(c => ({\n\t\t\t...c,\n\t\t\tcontroller: MitsubishiController.create(c.ip, this.log),\n\t\t\tmac: undefined,\n\t\t}));\n\n\t\ttry {\n\t\t\tawait this.startPolling();\n\t\t\tawait this.setAdapterConnectionState(true);\n\t\t} catch (err: any) {\n\t\t\tthis.log.error(`Error while starting polling: ${err}`);\n\t\t\tawait this.setAdapterConnectionState(false);\n\t\t}\n\t}\n\n\t/**\n\t * Is called when adapter shuts down - callback has to be called under any circumstances!\n\t *\n\t * @param callback - Callback function\n\t */\n\tprivate onUnload(callback: () => void): void {\n\t\ttry {\n\t\t\tthis.stopPolling();\n\t\t\tcallback();\n\t\t} catch (error) {\n\t\t\tthis.log.error(`Error during unloading: ${(error as Error).message}`);\n\t\t\tcallback();\n\t\t}\n\t}\n\n\t/**\n\t * Is called if a subscribed state changes\n\t *\n\t * @param id - State ID\n\t * @param state - State object\n\t */\n\tprivate async onStateChange(id: string, state: ioBroker.State | null | undefined): Promise<void> {\n\t\tif (state) {\n\t\t\t// The state was changed\n\t\t\tthis.log.silly(`state ${id} changed: ${state.val} (ack = ${state.ack})`);\n\n\t\t\tif (state.ack === false) {\n\t\t\t\t// This is a command from the user (e.g., from the UI or other adapter)\n\t\t\t\t// and should be processed by the adapter\n\t\t\t\tthis.log.debug(`User command received for ${id}: ${state.val}`);\n\n\t\t\t\tconst mac = getMacFromStateId(id);\n\t\t\t\tif (!mac) {\n\t\t\t\t\tthis.log.error(`Unable to extract MAC address from state ID: ${id}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst device = this.getDeviceByMac(mac);\n\t\t\t\tif (!device) {\n\t\t\t\t\tthis.log.error(`No device found for MAC ${mac}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.log.debug(`Command on ${id} \u2192 forwarding to device ${device.name} (${mac})`);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (id.endsWith(\"power\")) {\n\t\t\t\t\t\tawait device.controller.setPower(state.val as boolean);\n\t\t\t\t\t} else if (id.endsWith(\"powerSaving\")) {\n\t\t\t\t\t\tawait device.controller.setPowerSaving(state.val as boolean);\n\t\t\t\t\t} else if (id.endsWith(\"targetTemperature\")) {\n\t\t\t\t\t\tawait device.controller.setTemperature(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"operationMode\")) {\n\t\t\t\t\t\tawait device.controller.setMode(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"fanSpeed\")) {\n\t\t\t\t\t\tawait device.controller.setFanSpeed(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"vaneVerticalDirection\")) {\n\t\t\t\t\t\tawait device.controller.setVerticalVane(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"vaneHorizontalDirection\")) {\n\t\t\t\t\t\tawait device.controller.setHorizontalVane(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"remoteLock\")) {\n\t\t\t\t\t\tawait device.controller.setRemoteLock(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"dehumidifierLevel\")) {\n\t\t\t\t\t\tawait device.controller.setDehumidifier(state.val as number);\n\t\t\t\t\t} else if (id.endsWith(\"triggerBuzzer\")) {\n\t\t\t\t\t\tawait device.controller.triggerBuzzer();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.log.warn(`Unhandled command for state ${id}`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (err: any) {\n\t\t\t\t\tthis.log.error(`Error executing command for ${device.name}: ${err}`);\n\t\t\t\t}\n\n\t\t\t\tawait this.setState(id, state.val, true); // command was confirmed by device, set ACK to true\n\t\t\t}\n\t\t} else {\n\t\t\t// The object was deleted or the state value has expired\n\t\t\tthis.log.silly(`state ${id} deleted`);\n\t\t}\n\t}\n\n\tprivate validateConfig(): boolean {\n\t\tthis.log.debug(\"Checking adapter settings...\");\n\n\t\t// --- Validate polling interval ---\n\t\tif (!this.config.pollingInterval || this.config.pollingInterval < 15) {\n\t\t\tthis.config.pollingInterval = 15;\n\t\t\tthis.log.warn(\"Polling interval can't be set lower than 15 seconds. Now set to 15 seconds.\");\n\t\t}\n\n\t\t// --- Validate devices array existence ---\n\t\tconst devices = this.config.devices;\n\t\tif (!devices || !Array.isArray(devices)) {\n\t\t\tthis.log.error(\"No valid devices configured. Please add at least one device.\");\n\t\t\treturn false;\n\t\t}\n\n\t\t// --- Filter invalid devices ---\n\t\tconst cleanedDevices = devices.filter(d => d?.name?.trim() && d?.ip?.trim() && isValidIPv4(d.ip.trim()));\n\n\t\tif (cleanedDevices.length !== devices.length) {\n\t\t\tthis.log.warn(\"Some device entries were invalid and have been removed.\");\n\t\t}\n\n\t\t// Update config\n\t\tthis.config.devices = cleanedDevices;\n\n\t\t// --- Check if at least one valid device remains ---\n\t\tif (this.config.devices.length === 0) {\n\t\t\tthis.log.error(\"No valid devices configured. Please add at least one device.\");\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async setAdapterConnectionState(isConnected: boolean): Promise<void> {\n\t\tawait this.setStateChangedAsync(\"info.connection\", isConnected, true);\n\t\tthis.setForeignState(`system.adapter.${this.namespace}.connected`, isConnected, true);\n\t}\n\n\tprivate getDeviceByMac(mac: string): Device | undefined {\n\t\tconst noColMac = String(mac)\n\t\t\t.toLowerCase()\n\t\t\t.replace(/[^0-9a-f]/g, \"\");\n\t\tif (noColMac.length !== 12) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst colMac = noColMac.match(/.{1,2}/g)!.join(\":\");\n\n\t\treturn this.devices.find(c => c.controller.parsedDeviceState?.mac === colMac);\n\t}\n\n\tprivate async startPolling(): Promise<void> {\n\t\tconst interval = this.config.pollingInterval * 1000;\n\n\t\tfor (const device of this.devices) {\n\t\t\tconst poll = async (): Promise<void> => {\n\t\t\t\tif (device.controller.isCommandInProgress) {\n\t\t\t\t\tthis.log.debug(`Skipping poll for ${device.name}: command in progress`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tthis.log.debug(`Polling ${device.name} (${device.ip}) ...`);\n\n\t\t\t\t\tconst parsed = await device.controller.fetchStatus();\n\t\t\t\t\tdevice.mac = parsed.mac;\n\n\t\t\t\t\tawait this.updateDeviceStates(this, parsed, device.name);\n\t\t\t\t\tawait this.setDeviceOnlineState(device.mac, true);\n\t\t\t\t} catch (err: any) {\n\t\t\t\t\tthis.log.error(`Polling error for ${device.name}: ${err}`);\n\t\t\t\t\tawait this.setDeviceOnlineState(device.mac, false);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tawait poll();\n\t\t\tdevice.pollingJob = setInterval(poll, interval);\n\t\t}\n\n\t\tthis.log.info(`Started polling all devices every ${this.config.pollingInterval} seconds.`);\n\t}\n\n\tprivate stopPolling(): void {\n\t\tthis.devices.forEach(c => {\n\t\t\tif (c.pollingJob) {\n\t\t\t\tclearInterval(c.pollingJob);\n\t\t\t\tthis.log.debug(`Cleared polling timer for device ${c.name}.`);\n\t\t\t}\n\t\t\tc.controller.cleanupController();\n\t\t});\n\t}\n\n\tprivate async setDeviceOnlineState(mac: string | undefined, isOnline: boolean): Promise<void> {\n\t\tif (mac) {\n\t\t\tawait this.setState(`${this.namespace}.devices.${mac.replace(/:/g, \"\")}.info.deviceOnline`, {\n\t\t\t\tval: isOnline,\n\t\t\t\tack: true,\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Aktualisiert die ioBroker-Objekte f\u00FCr ein ParsedDeviceState\n\t */\n\tasync writeRecursive(adapter: MitsubishiLocalControl, parentId: string, obj: any): Promise<void> {\n\t\tfor (const key of Object.keys(obj)) {\n\t\t\tconst value = obj[key];\n\n\t\t\tif (value && typeof value === \"object\" && !(value instanceof Date) && !Buffer.isBuffer(value)) {\n\t\t\t\tawait this.writeRecursive(adapter, parentId, value);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet type: ioBroker.CommonType = \"string\";\n\t\t\tlet name = key;\n\t\t\tlet desc: string | undefined = undefined;\n\t\t\tlet role = \"state\";\n\t\t\tlet unit: string | undefined = undefined;\n\t\t\tlet states: Record<string, string> | undefined;\n\t\t\tlet read = true;\n\t\t\tlet write = false;\n\t\t\tlet min: number | undefined = undefined;\n\t\t\tlet max: number | undefined = undefined;\n\n\t\t\t//// Map ParsedDeviceState keys to proper states\n\t\t\t// Map enums\n\t\t\tswitch (key) {\n\t\t\t\tcase \"operationMode\":\n\t\t\t\t\tif (isEnumValue(OperationMode, value)) {\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tstates = enumToStates(OperationMode);\n\t\t\t\t\t\trole = \"level.mode.airconditioner\";\n\t\t\t\t\t\tname = \"Operation Mode\";\n\t\t\t\t\t\tdesc = \"Sets the operation mode of the device\";\n\t\t\t\t\t\twrite = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"fanSpeed\":\n\t\t\t\t\tif (isEnumValue(FanSpeed, value)) {\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tstates = enumToStates(FanSpeed);\n\t\t\t\t\t\trole = \"level.mode.fan\";\n\t\t\t\t\t\tname = \"Fan speed\";\n\t\t\t\t\t\tdesc = \"Sets the fan speed when in manual mode\";\n\t\t\t\t\t\twrite = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"vaneVerticalDirection\":\n\t\t\t\t\tif (isEnumValue(VaneVerticalDirection, value)) {\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tstates = enumToStates(VaneVerticalDirection);\n\t\t\t\t\t\trole = \"level\";\n\t\t\t\t\t\tname = \"Vane vertical direction\";\n\t\t\t\t\t\tdesc = \"Sets the vertical direction of the vane\";\n\t\t\t\t\t\twrite = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"vaneHorizontalDirection\":\n\t\t\t\t\tif (isEnumValue(VaneHorizontalDirection, value)) {\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tstates = enumToStates(VaneHorizontalDirection);\n\t\t\t\t\t\trole = \"level\";\n\t\t\t\t\t\tname = \"Vane horizontal direction\";\n\t\t\t\t\t\tdesc = \"Sets the horizontal direction of the vane\";\n\t\t\t\t\t\twrite = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"autoMode\":\n\t\t\t\t\tif (isEnumValue(AutoMode, value)) {\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tstates = enumToStates(AutoMode);\n\t\t\t\t\t\trole = \"mode\";\n\t\t\t\t\t\tname = \"Auto mode\";\n\t\t\t\t\t\tdesc = \"Current auto mode of the device\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"remoteLock\":\n\t\t\t\t\tif (isEnumValue(RemoteLock, value)) {\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tstates = enumToStates(RemoteLock);\n\t\t\t\t\t\twrite = true;\n\t\t\t\t\t\tname = \"Remote lock\";\n\t\t\t\t\t\tdesc = \"Sets the remote lock state of the device\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t// Map other types\n\t\t\t\tdefault:\n\t\t\t\t\tif (typeof value === \"number\") {\n\t\t\t\t\t\tconst keyLower = key.toLowerCase();\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tdesc = String(key).charAt(0).toUpperCase() + String(key).slice(1);\n\n\t\t\t\t\t\tif (keyLower.includes(\"temperature\")) {\n\t\t\t\t\t\t\trole = \"value.temperature\";\n\t\t\t\t\t\t\tunit = \"\u00B0C\";\n\n\t\t\t\t\t\t\tif (keyLower.includes(\"targettemperature\")) {\n\t\t\t\t\t\t\t\twrite = true;\n\t\t\t\t\t\t\t\trole = \"level.temperature\";\n\t\t\t\t\t\t\t\tname = \"Target temperature\";\n\t\t\t\t\t\t\t\tdesc = \"Sets the target temperature of the device\";\n\t\t\t\t\t\t\t\tmin = 16;\n\t\t\t\t\t\t\t\tmax = 31;\n\t\t\t\t\t\t\t\tunit = \"\u00B0C\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (keyLower.includes(\"dehumidifierlevel\")) {\n\t\t\t\t\t\t\twrite = true;\n\t\t\t\t\t\t\tname = \"Dehumidifier level\";\n\t\t\t\t\t\t\tdesc = \"Sets the dehumidifier level\";\n\t\t\t\t\t\t\tunit = \"%\";\n\t\t\t\t\t\t\tmin = 0;\n\t\t\t\t\t\t\tmax = 100;\n\t\t\t\t\t\t\trole = \"level.humidity\";\n\t\t\t\t\t\t} else if (keyLower.includes(\"power\") || keyLower.includes(\"energy\")) {\n\t\t\t\t\t\t\trole = \"value.power\";\n\n\t\t\t\t\t\t\tif (keyLower.includes(\"energy\")) {\n\t\t\t\t\t\t\t\tunit = \"kWh\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (keyLower.includes(\"errorcode\")) {\n\t\t\t\t\t\t\tstates = { 32768: \"No error\" };\n\t\t\t\t\t\t\trole = \"value\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trole = \"value\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (typeof value === \"boolean\") {\n\t\t\t\t\t\tconst keyLower = key.toLowerCase();\n\t\t\t\t\t\ttype = \"boolean\";\n\n\t\t\t\t\t\tif (keyLower.includes(\"triggerbuzzer\")) {\n\t\t\t\t\t\t\trole = \"button\";\n\t\t\t\t\t\t\tname = \"Trigger buzzer\";\n\t\t\t\t\t\t\tdesc = \"Triggers the device buzzer\";\n\t\t\t\t\t\t\tread = false;\n\t\t\t\t\t\t\twrite = true;\n\t\t\t\t\t\t} else if (keyLower === \"power\") {\n\t\t\t\t\t\t\trole = \"switch.power\";\n\t\t\t\t\t\t\tname = \"Power\";\n\t\t\t\t\t\t\tdesc = \"Turns the device on or off\";\n\t\t\t\t\t\t\twrite = true;\n\t\t\t\t\t\t} else if (keyLower === \"powersaving\") {\n\t\t\t\t\t\t\trole = \"switch\";\n\t\t\t\t\t\t\tname = \"Power saving\";\n\t\t\t\t\t\t\tdesc = \"Enables or disables power saving mode\";\n\t\t\t\t\t\t\twrite = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trole = \"indicator\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (typeof value === \"string\") {\n\t\t\t\t\t\ttype = \"string\";\n\t\t\t\t\t\trole = \"text\";\n\t\t\t\t\t\tdesc = String(key).charAt(0).toUpperCase() + String(key).slice(1);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\t// State Objekt erstellen\n\t\t\tconst id = write ? `${parentId}.control.${key}` : `${parentId}.info.${key}`;\n\n\t\t\tawait adapter.setObjectNotExistsAsync(id, {\n\t\t\t\ttype: \"state\",\n\t\t\t\tcommon: {\n\t\t\t\t\tname: name,\n\t\t\t\t\tdesc: desc,\n\t\t\t\t\ttype,\n\t\t\t\t\trole,\n\t\t\t\t\tunit,\n\t\t\t\t\tread: read,\n\t\t\t\t\twrite: write,\n\t\t\t\t\tmin: min,\n\t\t\t\t\tmax: max,\n\t\t\t\t\t...(states ? { states } : {}),\n\t\t\t\t},\n\t\t\t\tnative: {},\n\t\t\t});\n\n\t\t\tif (write) {\n\t\t\t\tthis.subscribeStates(id);\n\t\t\t}\n\n\t\t\t// State setzen\n\t\t\tawait adapter.setState(id, { val: value, ack: true });\n\t\t}\n\t}\n\n\tasync updateDeviceStates(\n\t\tadapter: MitsubishiLocalControl,\n\t\tparsedState: ParsedDeviceState,\n\t\tdeviceName: string,\n\t): Promise<void> {\n\t\tconst deviceId = `devices.${parsedState.mac.replace(/:/g, \"\")}`;\n\n\t\t// Generate device object and common states\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}`, {\n\t\t\ttype: \"device\",\n\t\t\tcommon: {\n\t\t\t\tstatusStates: {\n\t\t\t\t\tonlineId: `${this.namespace}.${deviceId}.info.deviceOnline`,\n\t\t\t\t\terrorId: `${this.namespace}.${deviceId}.info.hasError`,\n\t\t\t\t},\n\t\t\t\tname: `${deviceName}`,\n\t\t\t},\n\t\t\tnative: {},\n\t\t});\n\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}.control`, {\n\t\t\ttype: \"channel\",\n\t\t\tcommon: { name: \"Device control\" },\n\t\t\tnative: {},\n\t\t});\n\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}.control.enableEchonet`, {\n\t\t\ttype: \"state\",\n\t\t\tcommon: {\n\t\t\t\tname: \"Enable ECHONET\",\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trole: \"button\",\n\t\t\t\tread: false,\n\t\t\t\twrite: true,\n\t\t\t\tdesc: \"Send enable ECHONET command\",\n\t\t\t\tdef: false,\n\t\t\t},\n\t\t\tnative: {},\n\t\t});\n\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}.control.rebootDevice`, {\n\t\t\ttype: \"state\",\n\t\t\tcommon: {\n\t\t\t\tname: \"Reboot device\",\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trole: \"button\",\n\t\t\t\tread: false,\n\t\t\t\twrite: true,\n\t\t\t\tdesc: \"Send reboot device command\",\n\t\t\t\tdef: false,\n\t\t\t},\n\t\t\tnative: {},\n\t\t});\n\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}.info`, {\n\t\t\ttype: \"channel\",\n\t\t\tcommon: { name: \"Device information\" },\n\t\t\tnative: {},\n\t\t});\n\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}.info.deviceOnline`, {\n\t\t\ttype: \"state\",\n\t\t\tcommon: {\n\t\t\t\tname: \"Is device online\",\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trole: \"indicator.reachable\",\n\t\t\t\tread: true,\n\t\t\t\twrite: false,\n\t\t\t\tdesc: \"Indicates if device is reachable\",\n\t\t\t\tdef: false,\n\t\t\t},\n\t\t\tnative: {},\n\t\t});\n\n\t\tawait adapter.setObjectNotExistsAsync(`${deviceId}.info.hasError`, {\n\t\t\ttype: \"state\",\n\t\t\tcommon: {\n\t\t\t\tname: \"Has device an error\",\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trole: \"indicator.error\",\n\t\t\t\tread: true,\n\t\t\t\twrite: false,\n\t\t\t\tdesc: \"Indicates if device has an error\",\n\t\t\t\tdef: false,\n\t\t\t},\n\t\t\tnative: {},\n\t\t});\n\n\t\t// Generate states from ParsedDeviceState\n\t\tawait this.writeRecursive(adapter, deviceId, parsedState);\n\n\t\t// Set error state according to error code\n\t\tawait adapter.setState(`${deviceId}.info.hasError`, { val: parsedState.errors?.isAbnormalState, ack: true });\n\t}\n}\n\nif (require.main !== module) {\n\t// Export the constructor in compact mode\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) => new MitsubishiLocalControl(options);\n} else {\n\t// otherwise start the instance directly\n\t(() => new MitsubishiLocalControl())();\n}\n"],
  "mappings": "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",
  "names": []
}
